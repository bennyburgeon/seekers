<!-- BEGIN PRE-FOOTER -->
<div class="page-prefooter">
	<div class="container">
		<div class="row">
			<div class="col-md-3 col-sm-6 col-xs-12 footer-block">
				<h2>About</h2>
				<p>
					 Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam dolore.
				</p>
			</div>
			<div class="col-md-3 col-sm-6 col-xs12 footer-block">
				<h2>Subscribe Email</h2>
				<div class="subscribe-form">
					<form action="javascript:;">
						<div class="input-group">
							<input type="text" placeholder="mail@email.com" class="form-control">
							<span class="input-group-btn">
							<button class="btn" type="submit">Submit</button>
							</span>
						</div>
					</form>
				</div>
			</div>
			<div class="col-md-3 col-sm-6 col-xs-12 footer-block">
				<h2>Follow Us On</h2>	
				<ul class="social-icons">
					<li>
						<a href="javascript:;" data-original-title="rss" class="rss"></a>
					</li>
					<li>
						<a href="javascript:;" data-original-title="facebook" class="facebook"></a>
					</li>
					<li>
						<a href="javascript:;" data-original-title="twitter" class="twitter"></a>
					</li>
					<li>
						<a href="javascript:;" data-original-title="googleplus" class="googleplus"></a>
					</li>
					<li>
						<a href="javascript:;" data-original-title="linkedin" class="linkedin"></a>
					</li>
					<li>
						<a href="javascript:;" data-original-title="youtube" class="youtube"></a>
					</li>
					<li>
						<a href="javascript:;" data-original-title="vimeo" class="vimeo"></a>
					</li>
				</ul>
			</div>
			<div class="col-md-3 col-sm-6 col-xs-12 footer-block">
				<h2>Contacts</h2>
				<address class="margin-bottom-40">
				Phone: 800 123 3456<br>
				 Email: <a href="mailto:info@metronic.com">info@metronic.com</a>
				</address>
			</div>
		</div>
	</div>
</div>
<!-- END PRE-FOOTER -->
<!-- BEGIN FOOTER -->
<div class="page-footer">
	<div class="container">
		 2014 &copy; Metronic. All Rights Reserved.
	</div>
</div>
<div class="scroll-to-top">
	<i class="icon-arrow-up"></i>
</div>
<!-- END FOOTER -->
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="<?php echo base_url();?>assets/global/plugins/respond.min.js"></script>
<script src="<?php echo base_url();?>assets/global/plugins/excanvas.min.js"></script> 
<![endif]-->
<script src="<?php echo base_url();?>assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.3.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/global/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN: Page level plugins -->
<script src="<?php echo base_url();?>assets/global/plugins/fancybox/source/jquery.fancybox.pack.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/global/plugins/bootstrap-wysihtml5/wysihtml5-0.3.0.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/global/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.js" type="text/javascript"></script>
<!-- BEGIN:File Upload Plugin JS files-->
<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/vendor/jquery.ui.widget.js"></script>
<!-- The Templates plugin is included to render the upload/download listings -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/vendor/tmpl.min.js"></script>
<!-- The Load Image plugin is included for the preview images and image resizing functionality -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/vendor/load-image.min.js"></script>
<!-- The Canvas to Blob plugin is included for image resizing functionality -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/vendor/canvas-to-blob.min.js"></script>
<!-- blueimp Gallery script -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/blueimp-gallery/jquery.blueimp-gallery.min.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/jquery.fileupload.js"></script>
<!-- The File Upload processing plugin -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/jquery.fileupload-process.js"></script>
<!-- The File Upload image preview & resize plugin -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/jquery.fileupload-image.js"></script>
<!-- The File Upload audio preview plugin -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/jquery.fileupload-audio.js"></script>
<!-- The File Upload video preview plugin -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/jquery.fileupload-video.js"></script>
<!-- The File Upload validation plugin -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/jquery.fileupload-validate.js"></script>
<!-- The File Upload user interface plugin -->
<script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/jquery.fileupload-ui.js"></script>
<!-- The main application script -->
<!-- The XDomainRequest Transport is included for cross-domain file deletion for IE 8 and IE 9 -->
<!--[if (gte IE 8)&(lt IE 10)]>
    <script src="<?php echo base_url();?>assets/global/plugins/jquery-file-upload/js/cors/jquery.xdr-transport.js"></script>
    <![endif]-->
<!-- END:File Upload Plugin JS files-->
<!-- END: Page level plugins -->
<script src="<?php echo base_url();?>assets/global/scripts/metronic.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/admin/layout3/scripts/layout.js" type="text/javascript"></script>
<script src="<?php echo base_url();?>assets/admin/layout3/scripts/demo.js" type="text/javascript"></script>



<script language="javascript" type="text/javascript">

var Inbox = function () {

    var content = $('.inbox-content');
    var loading = $('.inbox-loading');
    var listListing = '';

    var loadInbox = function (el, name) {
	
    var url = '<?php echo site_url();?>/my_inbox/inbox_view/'+name;
	 	
		//var url = 'inbox_inbox.html';
        var title = $('.inbox-nav > li.' + name + ' a').attr('data-title');
        listListing = name;

        loading.show();
        content.html('');
        toggleButton(el);

        $.ajax({
            type: "GET",
            cache: false,
            url: url,
            dataType: "html",
            success: function(res) 
            {
                toggleButton(el);

                $('.inbox-nav > li.active').removeClass('active');
                $('.inbox-nav > li.' + name).addClass('active');
                $('.inbox-header > h1').text(title);

                loading.hide();
                content.html(res);
                if (Layout.fixContentHeight) {
                    Layout.fixContentHeight();
                }
                Metronic.initUniform();
            },
            error: function(xhr, ajaxOptions, thrownError)
            {
                toggleButton(el);
            },
            async: false
        });

        // handle group checkbox:
        jQuery('body').on('change', '.mail-group-checkbox', function () {
            var set = jQuery('.mail-checkbox');
            var checked = jQuery(this).is(":checked");
            jQuery(set).each(function () {
                $(this).attr("checked", checked);
            });
            jQuery.uniform.update(set);
        });
    }
	
    var loadMessage = function (el, name, resetMenu) {
        var url = '<?php echo site_url();?>/my_inbox/inbox_load_msg';
		
        loading.show();
        content.html('');
        toggleButton(el);

        var message_id = el.parent('tr').attr("data-messageid");  
		
        $.ajax({
            type: "GET",
            cache: false,
            url: url,
            dataType: "html",
            data: {'message_id': message_id},
            success: function(res) 
            {
                toggleButton(el);

                if (resetMenu) {
                    $('.inbox-nav > li.active').removeClass('active');
                }
                $('.inbox-header > h1').text('View Message');

                loading.hide();
                content.html(res);
                Layout.fixContentHeight();
                Metronic.initUniform();
            },
            error: function(xhr, ajaxOptions, thrownError)
            {
                toggleButton(el);
            },
            async: false
        });
    }
	

	 var loadEditDraft = function (el, name, resetMenu) {
        var url = '<?php echo site_url();?>/my_inbox/draft_compose';
		
        loading.show();
        content.html('');
        toggleButton(el);

        var message_id = el.parent('tr').attr("data-messageid");  
		
        $.ajax({
            type: "GET",
            cache: false,
            url: url,
            dataType: "html",
            data: {'message_id': message_id},
            success: function(res) 
            {
                toggleButton(el);

                if (resetMenu) {
                    $('.inbox-nav > li.active').removeClass('active');
                }
                $('.inbox-header > h1').text('View Message');

                loading.hide();
                content.html(res);
                Layout.fixContentHeight();
                Metronic.initUniform();
            },
            error: function(xhr, ajaxOptions, thrownError)
            {
                toggleButton(el);
            },
            async: false
        });
    }
	
    

	var initWysihtml5 = function () {
        $('.inbox-wysihtml5').wysihtml5({
            "stylesheets": ["<?php echo base_url();?>/assets/global/plugins/bootstrap-wysihtml5/wysiwyg-color.css"]
        });
    }

    var initFileupload = function () {

        $('#fileupload').fileupload({
            // Uncomment the following to send cross-domain cookies:
            //xhrFields: {withCredentials: true},
            url: '<?php echo base_url();?>/assets/global/plugins/jquery-file-upload/server/php/',
            autoUpload: true
        });

        // Upload server status check for browsers with CORS support:
        if ($.support.cors) {
            $.ajax({
                url: '<?php echo base_url();?>/assets/global/plugins/jquery-file-upload/server/php/',
                type: 'HEAD'
            }).fail(function () {
                $('<span class="alert alert-error"/>')
                    .text('Upload server currently unavailable - ' +
                    new Date())
                    .appendTo('#fileupload');
            });
        }
    }

    var loadCompose = function (el) {
		
        var url = '<?php echo site_url();?>/my_inbox/inbox_compose';

        loading.show();
        content.html('');
        toggleButton(el);

        // load the form via ajax
        $.ajax({
            type: "GET",
            cache: false,
            url: url,
            dataType: "html",
            success: function(res) 
            {
                toggleButton(el);

                $('.inbox-nav > li.active').removeClass('active');
                $('.inbox-header > h1').text('Compose');

                loading.hide();
                content.html(res);

                initFileupload();
                initWysihtml5();

                $('.inbox-wysihtml5').focus();
                Layout.fixContentHeight();
                Metronic.initUniform();
            },
            error: function(xhr, ajaxOptions, thrownError)
            {
                toggleButton(el);
            },
            async: false
        });
    }

    var loadReply = function (el) {
        var url = '<?php echo site_url();?>/my_inbox/inbox_reply';
	
        loading.show();
        content.html('');
        toggleButton(el);
		 
		 var message_id = el.attr("messageid");

        // load the form via ajax
        $.ajax({
            type: "POST",
            cache: false,
            url: url,
			data: {'message_id': message_id},
            dataType: "html",
            success: function(res) 
            {
                toggleButton(el);

                $('.inbox-nav > li.active').removeClass('active');
                $('.inbox-header > h1').text('Reply');
                loading.hide();
                content.html(res);
              
                handleCCInput(); // init "CC" input field
                initFileupload();
                initWysihtml5();
                Layout.fixContentHeight();
                Metronic.initUniform();
            },
            error: function(xhr, ajaxOptions, thrownError)
            {
                toggleButton(el);
            },
            async: false
        });
    }

    var loadForward = function (el) {
        var url = '<?php echo site_url();?>/my_inbox/forward';
	
        loading.show();
        content.html('');
        toggleButton(el);
		 
		 var message_id = el.attr("messageid");

        // load the form via ajax
        $.ajax({
            type: "POST",
            cache: false,
            url: url,
			data: {'message_id': message_id},
            dataType: "html",
            success: function(res) 
            {
                toggleButton(el);

                $('.inbox-nav > li.active').removeClass('active');
                $('.inbox-header > h1').text('Forward');
                loading.hide();
                content.html(res);
               
                handleCCInput(); // init "CC" input field
                initFileupload();
                initWysihtml5();
                Layout.fixContentHeight();
                Metronic.initUniform();
            },
            error: function(xhr, ajaxOptions, thrownError)
            {
                toggleButton(el);
            },
            async: false
        });
    }

    var loadSearchResults = function (el, searchString) {
		var url = '<?php echo site_url();?>/my_inbox/inbox_search';
		
        loading.show();
        content.html('');
        toggleButton(el);

        $.ajax({
            type: "POST",
            cache: false,
            url: url,
			data: {'searchTerm': searchString},
            dataType: "html",
            success: function(res) 
            {
                toggleButton(el);

                $('.inbox-nav > li.active').removeClass('active');
                $('.inbox-header > h1').text('Search');

                loading.hide();
                content.html(res);
                Layout.fixContentHeight();
                Metronic.initUniform();
            },
            error: function(xhr, ajaxOptions, thrownError)
            {
				//alert(xhr.responseText);
                toggleButton(el);
            },
            async: false
        });
    }

    var handleCCInput = function () {
        var the = $('.inbox-compose .mail-to .inbox-cc');
        var input = $('.inbox-compose .input-cc');
        the.hide();
        input.show();
        $('.close', input).click(function () {
            input.hide();
            the.show();
        });
    }

    var handleBCCInput = function () {

        var the = $('.inbox-compose .mail-to .inbox-bcc');
        var input = $('.inbox-compose .input-bcc');
        the.hide();
        input.show();
        $('.close', input).click(function () {
            input.hide();
            the.show();
        });
    }

   
 var toggleButton = function(el) {
        if (typeof el == 'undefined') {
            return;
        }
        if (el.attr("disabled")) {
            el.attr("disabled", false);
        } else {
            el.attr("disabled", true);
        }
    }
	

    return {
        //main function to initiate the module
        init: function () {

            // handle compose btn click
            $('.inbox').on('click', '.compose-btn a', function () {
                loadCompose($(this));
            });

            // handle discard btn
            $('.inbox').on('click', '.inbox-discard-btn', function(e) {
                e.preventDefault();
                loadInbox($(this), listListing);
            });

            // handle reply and forward button click
            $('.inbox').on('click', '.reply-btn', function () {
				//alert('');
                loadReply($(this));
            });
            // handle reply and forward button click
            $('.inbox').on('click', '#reply_to', function () {
				//alert('');
                loadReply($(this));
            });			

            // handle forward button click
            $('.inbox').on('click', '#forward_to', function () {
				//alert('');
                loadForward($(this));
            });	
						
            // handle view message
            $('.inbox-content').on('click', '.view-message', function () {
                loadMessage($(this));
            });

            // handle edit/send draft message
            $('.inbox-content').on('click', '.view-messages', function () {
                loadEditDraft($(this));
            });
			
            // handle inbox listing
            $('.inbox-nav > li.inbox > a').click(function () {
                loadInbox($(this), 'inbox');
            });

            // handle sent listing
            $('.inbox-nav > li.sent > a').click(function () {
                loadInbox($(this), 'sent');
            });

            // handle draft listing
            $('.inbox-nav > li.draft > a').click(function () {
                loadInbox($(this), 'draft');
            });

            // handle trash listing
            $('.inbox-nav > li.trash > a').click(function () {
                loadInbox($(this), 'trash');
            });
			
            //handle compose/reply cc input toggle
            $('.inbox-content').on('click', '.mail-to .inbox-cc', function () {
                handleCCInput();
            });

            //handle compose/reply bcc input toggle
            $('.inbox-content').on('click', '.mail-to .inbox-bcc', function () {
                handleBCCInput();
            });
		
            //handle loading content based on URL parameter
            if (Metronic.getURLParameter("a") === "view") {
                loadMessage();
            } else if (Metronic.getURLParameter("a") === "compose") {
                loadCompose();
            } else {
               $('.inbox-nav > li.inbox > a').click();
            }
			
			//Handle Search button
			$('.inbox').on('click', '#searchBtn', function () {
				var searchString = $('#searchField').val();
				if($.trim(searchString) != '')
				{
					loadSearchResults($(this), searchString);
				} else {
					alert('Please enter the search term!');
					return false;
				}
            });	
			//Handle Search on Enter key down
			$('#searchField').on('keydown', function(e) {
				var key = e.which;
				if (key == 13) { // As ASCII code for ENTER key is "13"
					var searchString = $('#searchField').val();
					if($.trim(searchString) != '')
					{
						var Element = $(this).next().next();
						loadSearchResults(Element, searchString);
					} else {
						alert('Please enter the search term!');
						return false;
					}
				}
			});

			/*$('.pagination').on('click', function (event) {
				//alert('sss');
				var paginationVal = $(event.target).text();
				//var clickedElement = $(event.currentTarget === this);
				event.preventDefault();
				loadpagincation(paginationVal);
            });	
             

			 var loadpagincation = function (paginationVal) {

				var url = '<?php echo site_url();?>/my_inbox/inbox_view/inbox';
				    loading.show();
					content.html('');
					//toggleButton(el);

					$.ajax({
						type: "POST",
						cache: false,
						url: url,
						data: {'pageID': paginationVal},
						dataType: "html",
						success: function(res) 
						{
							//toggleButton(el);

							$('.inbox-nav > li.active').removeClass('active');
							$('.inbox-header > h1').text('Search');

							loading.hide();
							content.html(res);
							Layout.fixContentHeight();
							Metronic.initUniform();
						},
						error: function(xhr, ajaxOptions, thrownError)
						{
							//alert(xhr.responseText);
							//toggleButton(el);
						},
						async: false
					});
				}*/
			//AJAX EMAIL INBOX PAGINATION
			$('.pagination').on('click', function(event) {
				//event.stopImmediatePropagation(); 
				//event.preventDefault();
				var clickedElement = $(event.currentTarget);
				var paginationVal = $(event.target).text();
				//alert(paginationVal);
				var url = '<?php echo site_url();?>/my_inbox/inbox_view/inbox';
		
				loading.show();
				content.html('');
				toggleButton(clickedElement);

				$.ajax({
					type: "POST",
					cache: false,
					url: url,
					data: {'pageID': paginationVal},
					dataType: "html",
					success: function(res) 
					{
						toggleButton(clickedElement);

						$('.inbox-nav > li.active').removeClass('active');
						//$('.inbox-header > h1').text('Search');
						loading.hide();
						content.html(res);
						if (Layout.fixContentHeight) {
							Layout.fixContentHeight();
						}
						Metronic.initUniform();
						event.preventDefault();
						return false;
					},
					error: function(xhr, ajaxOptions, thrownError)
					{
						//alert(xhr.responseText);
						toggleButton(clickedElement);
					},
					async: false
				});
			});
        }

    };

}();
</script>

<script>
jQuery(document).ready(function() {       
   // initiate layout and plugins
    Metronic.init(); // init metronic core components
	Layout.init(); // init current layout
	Demo.init(); // init demo features
    Inbox.init();

	$('.fa-star').click(function() {
		var tableid = $(this).attr('id');	
		$.post("<?php echo site_url();?>/my_inbox/starred",{'tableid':tableid},function(data){			
			if(data){	 
				 window.location.href='<?php echo site_url();?>/my_inbox';					
			}else{
				$("#divError").html(data).show();											
				$('#loading_main').hide(); 
			}	
		});
	});

	$('#readall').click(function() {
		var chkId = '';
		$('.mail-checkbox:checked').each(function() {
		  chkId += $(this).val() + ",";
		});
		chkId = chkId.slice(0,-1);			
		$.post("<?php echo site_url();?>/my_inbox/makeMsgread",{'tableid':chkId},function(data){			
			if(data){	 
				 window.location.href='<?php echo site_url();?>/my_inbox';					
			}else{
				$("#divError").html(data).show();											
				$('#loading_main').hide(); 
			}	
		});
	});

	$('#unreadall').click(function() {
		var chkId = '';
		$('.mail-checkbox:checked').each(function() {
		  chkId += $(this).val() + ",";
		});
		chkId = chkId.slice(0,-1);			
		$.post("<?php echo site_url();?>/my_inbox/makeMsgUnread",{'tableid':chkId},function(data){			
			if(data){	 
				 window.location.href='<?php echo site_url();?>/my_inbox';					
			}else{
				$("#divError").html(data).show();											
				$('#loading_main').hide(); 
			}	
		});
	});

	$('#deleteall').click(function() {
		var chkId = '';
		$('.mail-checkbox:checked').each(function() {
		  chkId += $(this).val() + ",";
		});
		chkId = chkId.slice(0,-1);

		$.post("<?php echo site_url();?>/my_inbox/delete",{'tableid':chkId},function(data){			
			if(data){
				alert(data);
				 window.location.href='<?php echo site_url();?>/my_inbox';					
			}else{
				$("#divError").html(data).show();											
				$('#loading_main').hide(); 
			}	
		});
	});
		
});

</script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>